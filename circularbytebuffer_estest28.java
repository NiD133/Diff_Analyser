package org.apache.commons.io.input.buffer;

import org.junit.Test;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertFalse;

/**
 * Contains unit tests for the {@link CircularByteBuffer} class.
 * This class includes a refactored version of a test originally generated by EvoSuite.
 */
public class CircularByteBufferTest {

    /**
     * Tests that peek() returns false if the buffer contains fewer bytes than the
     * number of bytes requested to be peeked.
     */
    @Test
    public void peekShouldReturnFalseWhenLengthExceedsAvailableBytes() {
        // Arrange: Create an empty buffer with a capacity of 2.
        final int bufferSize = 2;
        final CircularByteBuffer buffer = new CircularByteBuffer(bufferSize);
        assertEquals("A new buffer should be empty", 0, buffer.getCurrentNumberOfBytes());

        // The contents of this array are irrelevant, as the peek operation
        // should fail on the length check before comparing any bytes.
        final byte[] bytesToCompare = new byte[16];
        final int peekLength = 2;

        // Act: Attempt to peek 2 bytes, which is more than the 0 bytes available.
        final boolean result = buffer.peek(bytesToCompare, 0, peekLength);

        // Assert: The peek operation should fail and not modify the buffer's state.
        assertFalse("peek() should return false when the buffer has fewer bytes than the requested length.", result);
        assertEquals("peek() should not consume bytes from the buffer", 0, buffer.getCurrentNumberOfBytes());
        assertEquals("peek() should not change the available space in the buffer", bufferSize, buffer.getSpace());
    }
}